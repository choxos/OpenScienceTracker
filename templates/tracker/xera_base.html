<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Open Science Tracker - Track transparency indicators in scientific publications{% endblock %}">
    <meta name="keywords" content="open science, transparency, research papers, data sharing, code sharing, scientific integrity">
    <meta name="author" content="Ahmad Sofi-Mahmudi">
    
    <title>{% block title %}Open Science Tracker{% endblock %} | Xera DB</title>
    
    <!-- Favicon -->
    {% load static %}
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Xera Unified Theme -->
    <link rel="stylesheet" href="{% static 'css/xera-unified-theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/transparency-colors.css' %}">
    
    <!-- Performance Optimizations -->
    <script src="{% static 'js/performance-optimizations.js' %}" defer></script>
    
    {% block extra_css %}{% endblock %}
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Open Science Tracker",
        "description": "Track transparency indicators in scientific publications",
        "url": "https://ost.xeradb.com",
        "author": {
            "@type": "Person",
            "name": "Ahmad Sofi-Mahmudi",
            "email": "ahmad.pub@gmail.com"
        },
        "applicationCategory": "ResearchTool",
        "operatingSystem": "Web Browser"
    }
    </script>
</head>
<body>
    <!-- Xera DB Unified Header -->
    <header class="xera-header">
        <div class="xera-header-container">
            <a href="{% url 'tracker:home' %}" class="xera-logo">
                <div class="xera-logo-icon">
                    <i class="fas fa-microscope"></i>
                </div>
                <div class="xera-app-name">
                    <div class="xera-app-title">OST</div>
                    <div class="xera-app-subtitle">Open Science Tracker</div>
                </div>
            </a>
            
            <nav class="xera-nav">
                <a href="{% url 'tracker:home' %}" class="xera-nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                    <i class="fas fa-home me-1"></i>Home
                </a>
                <a href="{% url 'tracker:paper_list' %}" class="xera-nav-link {% if 'paper' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-search me-1"></i>Search
                </a>
                <a href="{% url 'tracker:journal_list' %}" class="xera-nav-link {% if 'journal' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-book me-1"></i>Journals
                </a>
                <a href="{% url 'tracker:field_list' %}" class="xera-nav-link {% if 'field' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-microscope me-1"></i>Fields
                </a>
                <a href="{% url 'tracker:statistics' %}" class="xera-nav-link {% if 'statistics' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-chart-bar me-1"></i>Analytics
                </a>
                <a href="/api/" class="xera-nav-link" target="_blank">
                    <i class="fas fa-code me-1"></i>API
                </a>
            </nav>
            
            <!-- Header Search Form -->
            <div class="xera-header-search">
                <form method="get" action="{% url 'tracker:paper_list' %}" class="xera-search-form">
                    <div class="xera-search-input-group">
                        <input type="text" 
                               name="q" 
                               class="xera-search-input" 
                               placeholder="Search papers..." 
                               value="{{ request.GET.q|default:'' }}"
                               aria-label="Search papers">
                        <button type="submit" class="xera-search-btn" aria-label="Search">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="xera-main-content">
        <div class="xera-container{% if full_width %}-fluid{% endif %}">
            
            <!-- Breadcrumb Navigation -->
            {% if show_breadcrumb %}
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{% url 'tracker:home' %}">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    {% block breadcrumb %}{% endblock %}
                </ol>
            </nav>
            {% endif %}

            <!-- Page Header -->
            {% if page_title %}
            <div class="xera-card mb-4">
                <div class="xera-card-header">
                    <h1 class="xera-card-title">
                        {% if page_icon %}<i class="{{ page_icon }} me-2"></i>{% endif %}
                        {{ page_title }}
                    </h1>
                    {% if page_description %}
                    <p class="mb-0 text-muted">{{ page_description }}</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Alert Messages -->
            {% if messages %}
            <div class="alerts-container mb-4">
                {% for message in messages %}
                <div class="xera-alert xera-alert-{{ message.tags }} alert-dismissible" role="alert">
                    <i class="fas fa-info-circle me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Main Content -->
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="xera-footer">
        <div class="xera-container">
            <div class="row">
                <div class="col-md-6">
                    <div class="xera-footer-brand">
                        <h5>Open Science Tracker</h5>
                        <p class="text-muted">Advancing transparency in scientific research</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="xera-footer-links">
                        <h6>Resources</h6>
                        <ul class="list-unstyled">
                            <li><a href="/api/" target="_blank">API Documentation</a></li>
                            <li><a href="{% url 'tracker:statistics' %}">Statistics</a></li>
                            <li><a href="mailto:ahmad.pub@gmail.com">Contact</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 text-muted">
                        Â© 2025 <a href="https://xeradb.com" target="_blank" class="text-decoration-none">Xera DB</a>. 
                        Built by <a href="https://scholar.google.com/citations?user=gTWPaFYAAAAJ&hl=en" target="_blank" class="text-decoration-none">Ahmad Sofi-Mahmudi</a>.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="xera-social-links">
                        <a href="https://github.com/choxos/OpenScienceTracker" target="_blank" class="text-muted me-3">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://x.com/ASofiMahmudi" target="_blank" class="text-muted me-3">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/asofimahmudi" target="_blank" class="text-muted">
                            <i class="fab fa-linkedin"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Theme Management -->
    <script>
    // Theme Manager Class for consistent theme handling
    class ThemeManager {
        constructor() {
            this.theme = localStorage.getItem('theme') || 'light';
            this.applyTheme();
            this.bindEvents();
        }

        applyTheme() {
            document.documentElement.setAttribute('data-theme', this.theme);
            localStorage.setItem('theme', this.theme);
            
            // Update theme toggle button if it exists
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            if (themeToggle && themeIcon) {
                themeIcon.className = this.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                themeToggle.setAttribute('aria-label', 
                    this.theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'
                );
            }
        }

        toggleTheme() {
            this.theme = this.theme === 'light' ? 'dark' : 'light';
            this.applyTheme();
        }

        bindEvents() {
            // Floating theme toggle
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => this.toggleTheme());
            }
            
            // Keyboard shortcut (Ctrl/Cmd + Shift + T)
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    this.toggleTheme();
                }
            });
        }
    }

    // Initialize theme manager when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        window.themeManager = new ThemeManager();
    });

    // Enhanced Search Functionality
    class SearchHandler {
        constructor() {
            this.searchInput = document.querySelector('.xera-search-input');
            this.searchForm = document.querySelector('.xera-search-form');
            this.bindEvents();
        }

        bindEvents() {
            if (this.searchInput) {
                // Enhanced search with debouncing
                let debounceTimer;
                this.searchInput.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        this.validateSearch(e.target.value);
                    }, 300);
                });

                // Submit on Enter
                this.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.submitSearch();
                    }
                });
            }

            if (this.searchForm) {
                this.searchForm.addEventListener('submit', (e) => {
                    const query = this.searchInput.value.trim();
                    if (!query) {
                        e.preventDefault();
                        this.showSearchError('Please enter a search term');
                    }
                });
            }
        }

        validateSearch(query) {
            const trimmedQuery = query.trim();
            if (trimmedQuery.length > 0 && trimmedQuery.length < 2) {
                this.showSearchHint('Enter at least 2 characters');
            } else {
                this.clearSearchHint();
            }
        }

        submitSearch() {
            if (this.searchForm) {
                this.searchForm.submit();
            }
        }

        showSearchError(message) {
            this.clearSearchHint();
            const hint = document.createElement('div');
            hint.className = 'search-hint error';
            hint.textContent = message;
            this.searchInput.parentNode.appendChild(hint);
        }

        showSearchHint(message) {
            this.clearSearchHint();
            const hint = document.createElement('div');
            hint.className = 'search-hint';
            hint.textContent = message;
            this.searchInput.parentNode.appendChild(hint);
        }

        clearSearchHint() {
            const existingHint = document.querySelector('.search-hint');
            if (existingHint) {
                existingHint.remove();
            }
        }
    }

    // Initialize search handler
    document.addEventListener('DOMContentLoaded', () => {
        new SearchHandler();
    });

    // Performance optimizations
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('SW registered'))
                .catch(registrationError => console.log('SW registration failed'));
        });
    }
    </script>

    <!-- Custom JavaScript -->
    {% block extra_js %}{% endblock %}
</body>
</html> 